Ты уже знаешь, что автоматизация ускоряет тестирование, помогает справиться с рутиной и уменьшает риск ошибок.

Чтобы получить пользу от автотестов, нужно правильно планировать их запуск.


Лучше всего запускать автотесты каждый раз, когда меняется код приложения. Тогда ты узнаешь, всё ли работает как нужно и где появились ошибки.

Такой вариант подойдёт, если автотестов мало: например, приложение небольшое или автоматизация только началась. Чем больше автотестов, тем дольше они выполняются и тем позже команда узнает о результатах.

Если тестов много, нужно уменьшать время прогона. Хорошим результатом считается прогонять тесты за 8-10 минут.


### Ориентироваться на пирамиду тестирования

Пирамида показывает, что быстрых тестов нужно писать больше, чем медленных. Например, юнит-тестов должно быть больше, чем E2E. Тогда приложение будет хорошо покрыто тестами, а прогон не займёт много времени.

Юнит-тест обычно выполняется несколько миллисекунд или десятков миллисекунд. В больших проектах бывают десятки тысяч юнит-тестов.

E2E-тест может длиться несколько минут. Чтобы ускорить прогон с тем же процентом покрытия, можно частично заменить E2E-тесты юнит-тестами. Например, вместо десяти E2E-тестов написать один E2E и 10-15 юнит-тестов.

Если проект большой, со временем тестов становится много, даже если разрабатывать их по пирамиде тестирования. Тогда прогон занимает слишком много времени.


### Выполнять автотесты в несколько потоков

Ещё один способ ускорить прогон — выполнять автотесты [в несколько потоков](https://praktikum.yandex.ru/trainer/qa-automation-engineer-java-extended/lesson/e6dfcc44-f304-4fe1-ab44-1bd234c54a77/). Чем больше потоков, тем быстрее пройдут тесты.

Обрати внимание: это правило работает не всегда. Если потоков много, нужна большая мощность серверов. Из-за этого сложнее распределить автотесты по потокам.

Тесты могут выполняться медленнее, если у потоков общие ресурсы: например, база с тестовыми данными. Придётся выбирать, какие проверки когда запускать.


### Когда запускать тесты

**Юнит-тесты** быстрые, поэтому их обычно запускают после каждой сборки приложения. Разработчик может быстро получить отчёт и продолжить писать код. Или исправлять ошибки.

Для **интеграционных и E2E-тестов** есть разные варианты запуска.


✅ **«По кнопке»**. Тесты запускаются каждый раз, когда кто-то в команде решает, что нужен прогон.

Обычно «кнопка» — это команда запуска автотестов в инструменте CI/CD: например, Jenkins.

Плюсы: можно запускать автотесты когда угодно.

Минусы: запуск автотестов — это ручная операция, про которую можно забыть.


⏰ **По расписанию**. Команда решает, сколько раз в день и в какое время запускать тесты. Например, через планировщик заданий сервера CI/CD.

Чаще всего тесты запускают раз в день — ночью. Иногда бывает два прогона: ночью и в середине дня.

Когда прогон занимает много времени, автотесты можно запускать не каждый день. Например, если команда написала много E2E-тестов.

Плюсы: никто не забудет нажать кнопку запуска. Можно получить отчёт о тестировании в точное время — оно известно заранее. Например, утром после ночного прогона.

Минусы: чтобы получить отчёт, нужно дождаться запуска автотестов по расписанию.


➡️ **Перед релизом**. Некоторые команды запускают все автотесты прямо перед релизом.

Плюсы: можно ускорить прогон тестов, если приложение небольшое, а релизы проходят часто.

Минусы: если приложение большое, а релизы проходят редко, есть риск узнать об ошибках слишком поздно. Если в приложении много багов, придётся отложить релиз.

Обычно можно совмещать несколько вариантов, Например, автотесты выполняются по расписанию, но их можно запустить и вручную — «по кнопке».


Есть и другие способы сократить время прогона. Например, выполнять не все интеграционные и E2E-тесты, а только для той функциональности, которая изменилась.

Например, разработчик добавил кнопку «Повторить последний заказ» для корзины интернет-магазина. Можно выполнить все интеграционные и E2E-тесты только для корзины заказов, а для остальных частей запустить регрессионное тестирование.

Автотесты разбивают на тест-сьюты или тест-планы для отдельной функциональности. При запуске в качестве параметра передают список тест-сьютов, которые нужно выполнить.

Ты можешь комбинировать все эти способы. Например, на каждое изменение кода выполнять тест-сьют для этой функциональности, а по ночам делать полный прогон.